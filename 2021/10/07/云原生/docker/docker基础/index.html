<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>docker基础 | naive的博客</title><meta name="keywords" content="容器云,docker"><meta name="author" content="naive"><meta name="copyright" content="naive"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、容器容器解决的问题开发人员通常使用多种服务（比如MQ、Cache、DB）构建和组装应用，而且可能会部署到不同环境。  应用包含多种服务，这些服务有自己所依赖的库和软件包 存在多部署环境，服务在运行时可能需要动态迁移到不同环境中,开发环境-&gt;测试环境-&gt;生产环境。  容器的优势对于开发人员:Build Once、Run Anywhere。容器意味着环境隔离和可重复性。开发人员只需为应">
<meta property="og:type" content="article">
<meta property="og:title" content="docker基础">
<meta property="og:url" content="http://yoursite.com/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="naive的博客">
<meta property="og:description" content="一、容器容器解决的问题开发人员通常使用多种服务（比如MQ、Cache、DB）构建和组装应用，而且可能会部署到不同环境。  应用包含多种服务，这些服务有自己所依赖的库和软件包 存在多部署环境，服务在运行时可能需要动态迁移到不同环境中,开发环境-&gt;测试环境-&gt;生产环境。  容器的优势对于开发人员:Build Once、Run Anywhere。容器意味着环境隔离和可重复性。开发人员只需为应">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/img/photo-1626277787644-47d530591292.jpg">
<meta property="article:published_time" content="2021-10-07T15:19:01.000Z">
<meta property="article:modified_time" content="2021-10-16T12:16:12.669Z">
<meta property="article:author" content="naive">
<meta property="article:tag" content="容器云">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/photo-1626277787644-47d530591292.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-16 20:16:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="naive的博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">130</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/photo-1626277787644-47d530591292.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">naive的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">docker基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-07T15:19:01.000Z" title="发表于 2021-10-07 23:19:01">2021-10-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-16T12:16:12.669Z" title="更新于 2021-10-16 20:16:12">2021-10-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、容器"><a href="#一、容器" class="headerlink" title="一、容器"></a>一、容器</h2><h3 id="容器解决的问题"><a href="#容器解决的问题" class="headerlink" title="容器解决的问题"></a>容器解决的问题</h3><p>开发人员通常使用多种服务（比如MQ、Cache、DB）构建和组装应用，而且可能会部署到不同环境。</p>
<ul>
<li>应用包含多种服务，这些服务有自己所依赖的库和软件包</li>
<li>存在多部署环境，服务在运行时可能需要动态迁移到不同环境中,开发环境-&gt;测试环境-&gt;生产环境。</li>
</ul>
<h3 id="容器的优势"><a href="#容器的优势" class="headerlink" title="容器的优势"></a>容器的优势</h3><p>对于开发人员:<strong>Build Once、Run Anywhere</strong>。<br>容器意味着环境隔离和可重复性。开发人员只需为应用创建一次运行环境，然后打包成容器便可在其他机器上运行。另外，容器环境与所在的 Host 环境是隔离的，就像虚拟机一样，但更快更简单。</p>
<p>对于运维人员:<strong>Configure Once、Run Anything</strong>。<br>只需要配置好标准的runtime环境，服务器就可以运行任何容器。这使得运维人员的工作变得更高效、一致和可重复。容器消除了开发、测试、生产环境的不一致性。</p>
<h2 id="二、Docker概念"><a href="#二、Docker概念" class="headerlink" title="二、Docker概念"></a>二、Docker概念</h2><h3 id="docker架构"><a href="#docker架构" class="headerlink" title="docker架构"></a>docker架构</h3><p>Docker 采用的是 Client/Server架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过socket或RESTAPI与远程的服务器通信。</p>
<p><img src="/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/docker%E5%9F%BA%E7%A1%80.svg" alt="img"></p>
<ul>
<li>Docker_Host：<ul>
<li>安装Docker的主机</li>
</ul>
</li>
<li>Docker Daemon：<ul>
<li>运行在Docker主机上的Docker后台进程，负责创建、运行、监控容器，构建存储镜像</li>
</ul>
</li>
<li>Client：<ul>
<li>操作Docker主机的客户端（命令行、UI等）</li>
</ul>
</li>
<li>Registry：<ul>
<li>镜像仓库</li>
<li>Docker Hub</li>
</ul>
</li>
<li>Images：<ul>
<li>镜像，带环境打包好的程序，可以直接启动运行。只读模板，通过它可以创建Docker容器</li>
</ul>
</li>
<li>Containers：<ul>
<li>容器就是docker镜像的运行实例，用户可以通过CLI或是API启动、停止、移动或删除容器。对于应用软件，镜像是软件生命周期的构建和打包阶段，而容器是启动和运行阶段。</li>
</ul>
</li>
</ul>
<h3 id="docker镜像"><a href="#docker镜像" class="headerlink" title="docker镜像"></a>docker镜像</h3><p>每一个镜像都是从基础镜像开始的</p>
<h4 id="base镜像"><a href="#base镜像" class="headerlink" title="base镜像"></a>base镜像</h4><p>base镜像有两层含义:</p>
<ul>
<li>不依赖其他镜像，从 <code>scratch</code>构建;</li>
<li>其他镜像可以以之为基础进行扩展。</li>
</ul>
<p>所以，能称作 base镜像的通常都是各种 Linux发行版的 Docker镜像，比如Ubuntu、Debian、CentOS等。</p>
<p>为什么一个centos的镜像只有200MB?</p>
<p>Linux内核由内核空间和用户空间构成:</p>
<img src="/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/Linux操作系统构成.png" style="zoom:67%;">

<ol>
<li><p><strong>rootfs</strong> </p>
<p>内核空间是<code>kernel</code>，Linux 刚启动时会加载bootfs文件系统，之后 bootfs会被卸载掉。</p>
<p>用户空间的文件系统是 <code>rootfs</code>，包含我们熟悉的ldev、/proc、/bin等目录。<br>对于 base镜像来说，底层直接用Host 的 kernel，自己只需要提供<code>rootfs</code>就行了。<br>而对于一个精简的OS，rootfs可以很小，只需要包括最<strong>基本的命令、工具和程序库</strong>就可以了。</p>
</li>
<li><p><strong>base镜像提供的是最小安装的linux发行版</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> centos-7-docker.tar.xz /</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/basg&quot;</span>]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>支持多种Linux OS</strong></p>
<p>ubuntu使用upstart管理服务，apt管理软件包；而CentOS7使用systemd和yum这些都是用户空间上的区别，Linux kernel差别不大。</p>
<img src="/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/多种OS.png" alt="image-20211008225305039" style="zoom:67%;">

</li>
</ol>
<p>容器<strong>只能使用Host的kernel</strong>，并且不能修改。<br>所有容器都共用host 的 kernel，在容器中没办法对kernel升级。如果容器对kernel 版本有要求（比如应用只能在某个 kernel版本下运行)，则不建议用容器，这种场景虚拟机可能更合适。</p>
<h4 id="镜像的特点"><a href="#镜像的特点" class="headerlink" title="镜像的特点"></a>镜像的特点</h4><h5 id="分层结构"><a href="#分层结构" class="headerlink" title="分层结构"></a>分层结构</h5><p>新镜像是从base镜像一层一层叠加生成的。</p>
<p>好处就是<strong>共享资源</strong>，有多个镜像都是从相同的base镜像构建而来，那么Docker Host只需要在磁盘上保存一份base镜像，就可以为所有容器服务了，而且镜像的每一层都可以共享。</p>
<h5 id="写时复制"><a href="#写时复制" class="headerlink" title="写时复制"></a>写时复制</h5><p>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层叫容器层，所有对容器的改动，无论是添加、删除、函数修改文件都只发送在容器层中。容器层下面所有的镜像层是可写的。</p>
<p>任何对于文件的操作都会记录在容器层，例如：修改文件时容器层会把在镜像层找到的文件拷贝到容器层然后进行修改，删除文件时则会在容器层内记录删除文件的条目。</p>
<p><img src="/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/%E8%AF%BB%E5%86%99%E5%B1%82png.png" alt="读写层png"></p>
<p>所以，镜像可以被多个容器共享。</p>
<h5 id="联合挂载"><a href="#联合挂载" class="headerlink" title="联合挂载"></a>联合挂载</h5><p>容器层会从上到下去下一层的镜像层中去获取文件</p>
<p>当容器启动时，一个新的可写层<code>writable</code>被加载到镜像的顶部，这一层通常被称为容器层<code>container</code>，容器层之下的都叫做镜像层。</p>
<p>典型的Linux在启动后，会将<code>rootfs</code>置为只读<code>readonly</code>并进行一些列检查，然后将其切换为可读写<code>readwrite</code>供用户使用。在Docker中起初也是将<code>rootfs</code>以只读的<code>readonly</code>的方式加载并检查，然后接下来利用<code>union mount</code>联合挂载将一个<code>readwrite</code>文件系统挂载在<code>readonly</code>的<code>rootfs</code>之上，并且允许再次将下层的文件系统设定为只读<code>readonly</code>，并向上叠加。这样一组只读<code>readonly</code>和一个可写<code>writeable</code>的结果就构成了一个容器<code>container</code>的运行目录，每个镜像被称为一层<code>layer</code>。</p>
<h2 id="三、安装"><a href="#三、安装" class="headerlink" title="三、安装"></a>三、安装</h2><p>centos安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.docker.com/engine/install/centos/</span><br></pre></td></tr></table></figure>

<h3 id="1-移除旧的docker"><a href="#1-移除旧的docker" class="headerlink" title="1.移除旧的docker"></a>1.移除旧的docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<h3 id="2-配置yum源"><a href="#2-配置yum源" class="headerlink" title="2.配置yum源"></a>2.配置yum源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<h3 id="3-安装docker"><a href="#3-安装docker" class="headerlink" title="3.安装docker"></a>3.安装docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment">#以下是在安装k8s的时候使用</span></span><br><span class="line">yum install -y docker-ce-20.10.7 docker-ce-cli-20.10.7  containerd.io-1.4.6</span><br></pre></td></tr></table></figure>

<h3 id="4-启动"><a href="#4-启动" class="headerlink" title="4.启动"></a>4.启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开机自启并启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker --now</span><br></pre></td></tr></table></figure>

<h3 id="5、配置加速"><a href="#5、配置加速" class="headerlink" title="5、配置加速"></a>5、配置加速</h3><p>这里额外添加了docker的生产环境核心配置cgroup</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://82m9ar63.mirror.aliyuncs.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">  <span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="四、docker基本命令"><a href="#四、docker基本命令" class="headerlink" title="四、docker基本命令"></a>四、docker基本命令</h2><p><img src="/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E5%9F%BA%E7%A1%80/%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4.png" alt="image-20211008204653350"></p>
<h3 id="1-寻找镜像"><a href="#1-寻找镜像" class="headerlink" title="1.寻找镜像"></a>1.寻找镜像</h3><p>去<code>docker hub</code>寻找镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx  <span class="comment">#下载最新版</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#镜像名:版本名（标签）</span></span><br><span class="line">docker pull nginx:1.20.1</span><br><span class="line"></span><br><span class="line">docker pull redis  <span class="comment">#下载最新</span></span><br><span class="line">docker pull redis:6.2.4</span><br><span class="line"></span><br><span class="line"><span class="comment">## 下载来的镜像都在本地</span></span><br><span class="line">docker images  <span class="comment">#查看所有镜像</span></span><br><span class="line"></span><br><span class="line">redis = redis:latest</span><br><span class="line"><span class="comment">#删除镜像</span></span><br><span class="line">docker rmi 镜像名:版本号/镜像id</span><br></pre></td></tr></table></figure>

<h3 id="2-启动容器"><a href="#2-启动容器" class="headerlink" title="2.启动容器"></a>2.启动容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#【docker run  设置项   镜像名  】 镜像启动运行的命令（镜像里面默认有的，一般不会写）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -d：后台运行</span></span><br><span class="line"><span class="comment"># --restart=always: 开机自启</span></span><br><span class="line">docker run --name=mynginx   -d  --restart=always -p  88:80   nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看正在运行的容器</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># 查看所有</span></span><br><span class="line">docker ps -a</span><br><span class="line"><span class="comment"># 删除停止的容器</span></span><br><span class="line">docker rm  容器id/名字</span><br><span class="line">docker rm -f mynginx   <span class="comment">#强制删除正在运行中的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#停止容器</span></span><br><span class="line">docker stop 容器id/名字</span><br><span class="line"><span class="comment">#再次启动</span></span><br><span class="line">docker start 容器id/名字</span><br><span class="line"></span><br><span class="line"><span class="comment">#应用开机自启</span></span><br><span class="line">docker update 容器id/名字 --restart=always</span><br></pre></td></tr></table></figure>

<h3 id="3、修改容器内容"><a href="#3、修改容器内容" class="headerlink" title="3、修改容器内容"></a>3、修改容器内容</h3><p>修改默认的index.html 页面</p>
<h4 id="1-进入容器修改"><a href="#1-进入容器修改" class="headerlink" title="1.进入容器修改"></a>1.进入容器修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入容器内部的系统，修改容器内容</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器id  /bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="2、挂载数据到外部修改"><a href="#2、挂载数据到外部修改" class="headerlink" title="2、挂载数据到外部修改"></a>2、挂载数据到外部修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=mynginx   \</span><br><span class="line">-d  --restart=always \</span><br><span class="line">-p  88:80 -v /data/html:/usr/share/nginx/html:ro  \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改页面只需要去 主机的 /data/html</span></span><br></pre></td></tr></table></figure>

<h3 id="4、提交修改"><a href="#4、提交修改" class="headerlink" title="4、提交修改"></a>4、提交修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">docker commit -a <span class="string">&quot;liuqi&quot;</span>  -m <span class="string">&quot;首页变化&quot;</span> 341d81f7504f mynginx:v1.0</span><br></pre></td></tr></table></figure>

<p>传输镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将镜像保存成压缩包</span></span><br><span class="line">docker save -o abc.tar mynginx:v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 别的机器加载这个镜像</span></span><br><span class="line">docker load -i abc.tar</span><br></pre></td></tr></table></figure>

<h3 id="5、推送远程仓库"><a href="#5、推送远程仓库" class="headerlink" title="5、推送远程仓库"></a>5、推送远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag local-image:tagname new-repo:tagname</span><br><span class="line">docker push new-repo:tagname</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把旧镜像的名字，改成仓库要求的新版名字</span></span><br><span class="line">docker tag mynginx:v1.0 liuqi/mynginx:v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录到docker hub</span></span><br><span class="line">docker login       </span><br><span class="line">docker <span class="built_in">logout</span>（推送完成镜像后退出）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送</span></span><br><span class="line">docker push liuqi/mynginx:v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 别的机器下载</span></span><br><span class="line">docker pull liuqi/mynginx:v1.0</span><br></pre></td></tr></table></figure>

<h3 id="6、补充"><a href="#6、补充" class="headerlink" title="6、补充"></a>6、补充</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker logs 容器名/id   排错</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器id /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker 经常修改nginx配置文件</span></span><br><span class="line">docker run -d -p 80:80 \</span><br><span class="line"><span class="comment">#ro容器里面不可以修改 rw容器里面也可以修改</span></span><br><span class="line">-v /data/html:/usr/share/nginx/html:ro \</span><br><span class="line">-v /data/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">--name mynginx-02 \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#把容器指定位置的东西复制出来 </span></span><br><span class="line">docker cp 5eff66eec7e1:/etc/nginx/nginx.conf  /data/conf/nginx.conf</span><br><span class="line"><span class="comment">#把外面的内容复制到容器里面</span></span><br><span class="line">docker cp  /data/conf/nginx.conf  5eff66eec7e1:/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<h2 id="五、打包镜像Dockerfile"><a href="#五、打包镜像Dockerfile" class="headerlink" title="五、打包镜像Dockerfile"></a>五、打包镜像Dockerfile</h2><h3 id="镜像特点"><a href="#镜像特点" class="headerlink" title="镜像特点"></a>镜像特点</h3><h4 id="镜像的缓存特性"><a href="#镜像的缓存特性" class="headerlink" title="镜像的缓存特性"></a>镜像的缓存特性</h4><p>Docker会缓存已有镜像的镜像层，构建新镜像时，如果某镜像层已经存在，就直接使用，无须重新创建。</p>
<p>如果出现<code>Using cache</code>,就说明命中缓存。</p>
<p>如果我们希望在构建镜像时不使用缓存，可以在 docker build命令中加上<code>--no-cache</code>参数。Dockerfile 中每一个指令都会创建一个镜像层，<strong>上层是依赖于下层的</strong>。无论什么时候，只要某一层发生变化，其上面所有层的缓存都会失效。<br>也就是说，如果我们改变Dockerfile指令的执行顺序，或者修改或添加指令，都会使缓存失效。</p>
<h4 id="调试Dockerfile"><a href="#调试Dockerfile" class="headerlink" title="调试Dockerfile"></a>调试Dockerfile</h4><p>总结一下通过Dockerfile构建镜像的过程:</p>
<ul>
<li>从base镜像运行一个容器。</li>
<li>执行一条指令，对容器做修改。</li>
<li>执行类似 docker commit 的操作，生成一个新的镜像层。</li>
<li>Docker再基于刚刚提交的镜像运行一个新容器。</li>
<li>重复2~4步，直到Dockerfile中的所有指令执行完毕。</li>
</ul>
<p>从这个过程可以看出，如果 Dockerfile由于某种原因执行到某个指令失败了，我们也将能够得到<strong>前一个指令成功</strong>执行构建出的镜像，这对调试 Dockerfile非常有帮助。我们可以运行最新的这个镜像定位指令失败的原因。</p>
<p>通过<code>docker run -it 镜像id</code> 启动镜像的一个容器，定位问题。</p>
<h3 id="常用的Dockerfile命令"><a href="#常用的Dockerfile命令" class="headerlink" title="常用的Dockerfile命令"></a>常用的Dockerfile命令</h3><ol>
<li><p><code>FROM</code>:指定基础镜像。</p>
</li>
<li><p><code>MAINTAINER</code>:作者</p>
</li>
<li><p><code>COPY</code>：</p>
<p>将文件从build context复制到镜像。</p>
<p>COPY支持两种形式:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> src dest </span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">&quot;src&quot;</span>, <span class="string">&quot;dest&quot;</span>]。</span></span><br></pre></td></tr></table></figure>

<p>注意:src只能指定build context中的文件或目录。</p>
</li>
<li><p><code>ADD</code>:与COPY类似，从 build context 复制文件到镜像。不同的是，如果 src是归档文件(tar、zip、tgz、xz 等)，文件会被自动解压到dest。</p>
</li>
<li><p><code>ENV</code>:设置环境变量,环境变量可被后面的指令使用。例如:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY VERSION <span class="number">1.3</span> <span class="keyword">RUN</span><span class="bash"> apt-get install -y mypackage=<span class="variable">$MY</span> VERSION</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>EXPOSE</code><br>指定容器中的<strong>进程会监听某个端口</strong>，Docker 可以将该端口暴露出来。我们会在容器网络部分详细讨论。</p>
</li>
<li><p><code>VOLUME</code><br>将文件或目录声明为volume。</p>
</li>
<li><p><code>WORKDIR</code><br>为后面的RUN、CMD、ENTRYPOINT、ADD或COPY指令<strong>设置镜像中的当前工作目录。</strong></p>
</li>
<li><p><code>RUN</code><br>在容器中运行指定的命令。</p>
</li>
<li><p><code>CMD</code><br>容器启动时运行指定的命令。</p>
<p>Dockerfile 中可以有多个CMD指令，但<strong>只有最后一个生效</strong>。CMD可以被docker run 之后的参数替换。</p>
</li>
<li><p><code>ENTRYPOINT</code><br>设置容器<strong>启动时运行的命令</strong>。<br>Dockerfile 中可以有多个ENTRYPOINT 指令，但<strong>只有最后一个生效</strong>。CMD或docker run之后的参数会被当作<strong>参数</strong>传递给ENTRYPOINT。</p>
</li>
</ol>
<h3 id="RUN-vs-CMD-vs-ENTRYPOINT"><a href="#RUN-vs-CMD-vs-ENTRYPOINT" class="headerlink" title="RUN vs CMD vs ENTRYPOINT"></a>RUN vs CMD vs ENTRYPOINT</h3><ul>
<li><code>RUN</code>: 执行命令并创建新的镜像层，RUN经常用于安装软件包</li>
<li><code>CMD</code>：设置容器启动后默认执行的命令和参数，但CMD会被docker run后面跟着的命令行参数替换。</li>
<li><code>ENTRYPOINT</code>：配置容器启动时运行的命令。</li>
</ul>
<h4 id="1-Shell和Exec"><a href="#1-Shell和Exec" class="headerlink" title="1.Shell和Exec"></a>1.Shell和Exec</h4><p><strong>shell格式</strong>：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">instruction command</span><br><span class="line"></span><br><span class="line"><span class="comment">#例如</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install python3</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello world&quot;</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello world&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>命令执行时，shell底层会调用<code>/bin/sh -c [command]</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> name Cloud Man <span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$name</span>&quot;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>Exec格式</strong>：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">instruction [<span class="string">&quot;executable&quot;</span>,<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#例如</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;apt-get&quot;</span>,<span class="string">&quot;isntall&quot;</span>,<span class="string">&quot;python&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/echo&quot;</span>,<span class="string">&quot;Hello world&quot;</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/bin/echo&quot;</span>,<span class="string">&quot;Hello world&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>命令执行时，会直接调用[command]，不会被shell解析。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> name Cloud Man <span class="keyword">ENTRYPOINT</span><span class="bash">[<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo Hello, <span class="variable">$name</span>&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="2-RUN"><a href="#2-RUN" class="headerlink" title="2.RUN"></a>2.RUN</h4><p>通常用于安装用于和软件包。RUN命令在当前镜像的顶部执行命令，并创建新的镜像层。</p>
<h4 id="3-CMD"><a href="#3-CMD" class="headerlink" title="3.CMD"></a>3.CMD</h4><p>CMD指令允许用户指定容器的<strong>默认执行的命令</strong>。此命令会在容器启动且 docker run没有指定其他命令时运行。<br>如果docker run指定了其他命令，CMD指定的默认命令将被忽略。如果 Dockerfile 中有多个CMD指令，只有最后一个CMD有效。CMD有三种格式:</p>
<ul>
<li>Exec格式:<code>CMD[&quot; executable&quot; ,&quot;param1 &quot;,&quot;param2&quot;]</code>这是 CMD的推荐格式。</li>
<li><code>CMD[&quot;param1 &quot;,&quot;param2&quot;]</code>为 ENTRYPOINT<strong>提供额外的参数</strong>，此时ENTRYPONT必须使用 Exec格式。</li>
<li>Shell格式:<code>CMD command param1 param2</code></li>
</ul>
<p>第二种格式CMD [“param1”,”param2”]要与 Exec格式的 ENTRYPOINT 指令配合使用，其用途是为 ENTRYPOINT 设置默认的参数。</p>
<h4 id="4-ENTRYPOINT"><a href="#4-ENTRYPOINT" class="headerlink" title="4.ENTRYPOINT"></a>4.ENTRYPOINT</h4><p>ENTRYPOINT指令可让容器<strong>以应用程序或者服务的形式运行</strong>。</p>
<p>ENTRYPOINT看上去与CMD很像，它们都可以指定要执行的命令及其参数。不同的地方在于<strong>ENTRYPOINT不会被忽略</strong>，一定会被执行，即使运行 docker run时指定了其他命令。<br>ENTRYPOINT有两种格式:</p>
<ul>
<li>Exec格式:<code>ENTRYPOINT [&quot;executable&quot;, &quot;&quot;param1&quot;, &quot;param2&quot;&quot;]</code>这是ENTRYPOINT 的推荐格式。</li>
<li>Shell格式:<code>ENTRYPOINT command paraml param2</code>。</li>
</ul>
<p>ENTRYPOINT两种格式的效果差别很大。</p>
<p><strong>Exec 格式</strong>：</p>
<p>ENTRYPOINT的 Exec格式用于<strong>设置要执行的命令及其参数</strong>，同时可通过CMD 提供额外的参数。</p>
<p>ENTRYPOINT 中的<strong>参数始终会被使用</strong>，而CMD的额外参数可以在<strong>容器启动时动态替换掉</strong>。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/bin/echo&quot;</span>, <span class="string">&quot;Hello&quot;</span>]CMD [ <span class="string">&quot;world&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#docker run -it[image]</span></span><br><span class="line"><span class="comment">#Hello world</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#docker run -it [image] CloudMan</span></span><br><span class="line"><span class="comment">#Hello CloudMan</span></span><br></pre></td></tr></table></figure>

<p><strong>Shell模式</strong>会忽略如何CMD或docker run 提供的参数。</p>
<h3 id="打包一个web应用"><a href="#打包一个web应用" class="headerlink" title="打包一个web应用"></a>打包一个web应用</h3><h4 id="1-编写Dockerfile"><a href="#1-编写Dockerfile" class="headerlink" title="1.编写Dockerfile"></a>1.编写Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-slim</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=leifengyang</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> target/*.jar   /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="2-打包"><a href="#2-打包" class="headerlink" title="2.打包"></a>2.打包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t java-demo:v1.0 .</span><br></pre></td></tr></table></figure>

<h2 id="六、服务的启动"><a href="#六、服务的启动" class="headerlink" title="六、服务的启动"></a>六、服务的启动</h2><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /data/redis/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /data/redis/data:/data \</span><br><span class="line">-d --name myredis \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">redis:latest  redis-server /etc/redis/redis.conf \</span><br><span class="line">--appendonly yes</span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/">容器云</a><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="post_share"><div class="social-share" data-image="/./img/photo-1626277787644-47d530591292.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/10/%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%E7%BD%91%E7%BB%9C/"><img class="prev-cover" src="/./img/photo-1465156799763-2c087c332922.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">docker网络</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/07/%E4%BA%91%E5%8E%9F%E7%94%9F/%E4%BA%91%E5%8E%9F%E7%94%9F/"><img class="next-cover" src="/./img/photo-1626277787644-47d530591292.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">云原生</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/10/16/云原生/docker/docker日志和监控/" title="docker日志和监控"><img class="cover" src="/./img/photo-1626811407568-2f41c53fff99.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-16</div><div class="title">docker日志和监控</div></div></a></div><div><a href="/2021/10/10/云原生/docker/docker资源限制和底层技术/" title="docker资源限制和底层技术"><img class="cover" src="/./img/photo-1465156799763-2c087c332922.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-10</div><div class="title">docker资源限制和底层技术</div></div></a></div><div><a href="/2021/10/10/云原生/docker/docker网络/" title="docker网络"><img class="cover" src="/./img/photo-1465156799763-2c087c332922.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-10</div><div class="title">docker网络</div></div></a></div><div><a href="/2021/10/16/云原生/docker/docker数据卷/" title="docker数据卷"><img class="cover" src="/./img/photo-1465188162913-8fb5709d6d57.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-16</div><div class="title">docker数据卷</div></div></a></div><div><a href="/2021/10/13/云原生/docker/docker镜像/" title="docker镜像"><img class="cover" src="/./img/photo-1626427832435-d6c500cc2686.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-13</div><div class="title">docker镜像</div></div></a></div><div><a href="/2021/10/07/云原生/云原生/" title="云原生"><img class="cover" src="/./img/photo-1626277787644-47d530591292.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-07</div><div class="title">云原生</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%B9%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">一、容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">容器解决的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.2.</span> <span class="toc-text">容器的优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">二、Docker概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E6%9E%B6%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">docker架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.</span> <span class="toc-text">docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#base%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">base镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.2.</span> <span class="toc-text">镜像的特点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">分层结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">写时复制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%8C%82%E8%BD%BD"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">联合挂载</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">三、安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A7%BB%E9%99%A4%E6%97%A7%E7%9A%84docker"><span class="toc-number">3.1.</span> <span class="toc-text">1.移除旧的docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AEyum%E6%BA%90"><span class="toc-number">3.2.</span> <span class="toc-text">2.配置yum源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85docker"><span class="toc-number">3.3.</span> <span class="toc-text">3.安装docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%90%AF%E5%8A%A8"><span class="toc-number">3.4.</span> <span class="toc-text">4.启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E9%85%8D%E7%BD%AE%E5%8A%A0%E9%80%9F"><span class="toc-number">3.5.</span> <span class="toc-text">5、配置加速</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">四、docker基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AF%BB%E6%89%BE%E9%95%9C%E5%83%8F"><span class="toc-number">4.1.</span> <span class="toc-text">1.寻找镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">2.启动容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E5%AE%B9%E5%99%A8%E5%86%85%E5%AE%B9"><span class="toc-number">4.3.</span> <span class="toc-text">3、修改容器内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%E4%BF%AE%E6%94%B9"><span class="toc-number">4.3.1.</span> <span class="toc-text">1.进入容器修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0%E5%A4%96%E9%83%A8%E4%BF%AE%E6%94%B9"><span class="toc-number">4.3.2.</span> <span class="toc-text">2、挂载数据到外部修改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%8F%90%E4%BA%A4%E4%BF%AE%E6%94%B9"><span class="toc-number">4.4.</span> <span class="toc-text">4、提交修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%8E%A8%E9%80%81%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-number">4.5.</span> <span class="toc-text">5、推送远程仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E8%A1%A5%E5%85%85"><span class="toc-number">4.6.</span> <span class="toc-text">6、补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%89%93%E5%8C%85%E9%95%9C%E5%83%8FDockerfile"><span class="toc-number">5.</span> <span class="toc-text">五、打包镜像Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%89%B9%E7%82%B9"><span class="toc-number">5.1.</span> <span class="toc-text">镜像特点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%9A%84%E7%BC%93%E5%AD%98%E7%89%B9%E6%80%A7"><span class="toc-number">5.1.1.</span> <span class="toc-text">镜像的缓存特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95Dockerfile"><span class="toc-number">5.1.2.</span> <span class="toc-text">调试Dockerfile</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84Dockerfile%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">常用的Dockerfile命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RUN-vs-CMD-vs-ENTRYPOINT"><span class="toc-number">5.3.</span> <span class="toc-text">RUN vs CMD vs ENTRYPOINT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Shell%E5%92%8CExec"><span class="toc-number">5.3.1.</span> <span class="toc-text">1.Shell和Exec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-RUN"><span class="toc-number">5.3.2.</span> <span class="toc-text">2.RUN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-CMD"><span class="toc-number">5.3.3.</span> <span class="toc-text">3.CMD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ENTRYPOINT"><span class="toc-number">5.3.4.</span> <span class="toc-text">4.ENTRYPOINT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E4%B8%80%E4%B8%AAweb%E5%BA%94%E7%94%A8"><span class="toc-number">5.4.</span> <span class="toc-text">打包一个web应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99Dockerfile"><span class="toc-number">5.4.1.</span> <span class="toc-text">1.编写Dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%89%93%E5%8C%85"><span class="toc-number">5.4.2.</span> <span class="toc-text">2.打包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-number">6.</span> <span class="toc-text">六、服务的启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis"><span class="toc-number">6.1.</span> <span class="toc-text">redis</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By naive</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>